<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TaskMate</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/lib/core.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-dark.min.css">
  <style>
    :root {
      --primary: #8b5cf6;
      --primary-light: #c4b5fd;
      --primary-dark: #6d28d9;
      --secondary: #10b981;
      --secondary-light: #6ee7b7;
      --secondary-dark: #047857;
      --accent: #f59e0b;
      --accent-light: #fcd34d;
      --dark: #1e293b;
      --light: #f8fafc;
      --gray: #94a3b8;
      --gray-light: #e2e8f0;
      --danger: #ef4444;
      --danger-light: #fca5a5;
      --danger-dark: #dc2626;
      --glass: rgba(255, 255, 255, 0.15);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #1e293b, #0f172a);
      color: var(--light);
      min-height: 100vh;
      line-height: 1.6;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
      animation: fadeIn 0.8s ease-out;
    }

    header {
      text-align: center;
      margin-bottom: 3rem;
      position: relative;
    }

    .app-title {
      font-size: 4rem;
      font-weight: 900;
      background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 1rem;
      letter-spacing: -0.05em;
      background-size: 300% 300%;
      animation: gradientBG 8s ease infinite;
    }

    .app-subtitle {
      color: var(--gray-light);
      font-size: 1.3rem;
      margin-bottom: 2rem;
      font-weight: 300;
    }

    .tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 3rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .tab-btn {
      padding: 0.8rem 1.8rem;
      border: none;
      border-radius: 50px;
      background: var(--glass);
      backdrop-filter: blur(10px);
      color: var(--light);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.1);
      position: relative;
      overflow: hidden;
    }

    .tab-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: 0.5s;
    }

    .tab-btn:hover::before {
      left: 100%;
    }

    .tab-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    }

    .tab-btn.active {
      background: var(--primary);
      color: white;
      box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.8s ease-out;
    }

    .tab-content.active {
      display: block;
    }

    .card {
      background: var(--glass);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 2.5rem;
      margin-bottom: 2.5rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.1);
      transition: transform 0.4s ease, box-shadow 0.4s ease;
    }

    .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.2);
    }

    .card-title {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 2rem;
      color: white;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .card-title i {
      font-size: 1.5rem;
      color: var(--primary-light);
    }

    /* Task Manager Styles */
    .task-form {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr auto;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    @media (max-width: 1024px) {
      .task-form {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (max-width: 768px) {
      .task-form {
        grid-template-columns: 1fr;}
  .task-main {
    flex-direction: column;
    align-items: stretch;
  }

  .task-checkbox {
    margin-bottom: 1rem;
  }

  .task-delete {
    align-self: flex-end;
    margin-top: 1rem;
    margin-left: 0;
  }

  .task-meta {
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .task-item {
    padding: 1rem;
  }

  .task-text {
    font-size: 1rem;
  }
      }

    .task-input, .task-select, .task-date {
      padding: 1.2rem;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      font-size: 1rem;
      color: white;
      transition: all 0.3s ease;
    }

    .task-input::placeholder, .task-date::placeholder {
      color: rgba(255,255,255,0.5);
    }

    .task-input:focus, .task-select:focus, .task-date:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
    }

    .task-select {
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      background-size: 1rem;
    }

    .task-select option {
      background-color: #1e293b;
      color: white;
    }

    .add-task-btn {
      padding: 1.2rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
    }

    .add-task-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
    }

    .task-list {
      list-style: none;
    }
@keyframes pulse-red {
  0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
  70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
  100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
}
.task-item:hover {
  background: rgba(255,255,255,0.1);
  transform: translateX(5px);
}
    .task-item {
      display: flex;
      flex-direction: column;
      padding: 1.5rem;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      margin-bottom: 1rem;
      transition: all 0.3s ease;
      position: relative;
    }

    .task-item.overdue {
      background: rgba(239, 68, 68, 0.1);
      border-left: 4px solid var(--danger);
      animation: pulse-red 2s infinite;
    }

    .task-item.overdue .task-meta {
      color: var(--danger-light);
    }

    .task-item.overdue .task-deadline {
      color: var(--danger);
      font-weight: 600;
    }

.task-main {
  display: flex;
  flex-wrap: wrap;
  align-items: flex-start;
  gap: 1rem;
}

/* Make content flexible */
.task-content {
  flex: 1;
  min-width: 0;
  word-wrap: break-word;
}

    .task-checkbox {
      margin-right: 1.5rem;
      width: 22px;
      height: 22px;
      accent-color: var(--secondary);
      cursor: pointer;
      flex-shrink: 0;
    }

    .task-text {
      font-size: 1.1rem;
      color: white;
      margin-bottom: 0.5rem;
    }

    .task-text.completed {
      text-decoration: line-through;
      color: var(--gray);
    }

    .task-meta {
      display: flex;
      gap: 1.5rem;
      font-size: 0.9rem;
      color: var(--gray-light);
      margin-top: 0.5rem;
    }

    .task-subject {
      background: rgba(139, 92, 246, 0.2);
      padding: 0.3rem 0.8rem;
      border-radius: 50px;
      font-size: 0.8rem;
    }

    .task-type {
      background: rgba(16, 185, 129, 0.2);
      padding: 0.3rem 0.8rem;
      border-radius: 50px;
      font-size: 0.8rem;
    }

    .task-deadline {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .task-deadline i {
      font-size: 0.9rem;
    }

    .task-overdue {
      color: var(--danger);
      font-weight: 600;
      margin-left: 0.5rem;
    }

.task-delete {
  color: var(--danger-light);
  background: none;
  border: none;
  font-size: 1.3rem;
  cursor: pointer;
  transition: transform 0.3s ease;
  padding: 0.5rem;
  border-radius: 50%;
  margin-left: 1rem;
}

    .task-delete:hover {
      color: var(--danger);
      transform: scale(1.2);
      background: rgba(239, 68, 68, 0.1);
    }

    /* Pomodoro Timer Styles */
    .timer-container {
      text-align: center;
      padding: 2rem;
    }

    .timer-display {
      font-size: 6rem;
      font-weight: 700;
      margin: 1.5rem 0;
      color: white;
      font-family: 'Courier New', monospace;
      text-shadow: 0 0 10px rgba(255,255,255,0.2);
    }

    .timer-mode {
      font-size: 1.8rem;
      color: var(--secondary-light);
      margin-bottom: 1.5rem;
      text-transform: uppercase;
      letter-spacing: 3px;
      font-weight: 600;
    }

    .timer-buttons {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-top: 3rem;
    }

    .timer-btn {
      padding: 1rem 2rem;
      border: none;
      border-radius: 50px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.8rem;
      font-size: 1.1rem;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .timer-btn i {
      font-size: 1.2rem;
    }

    .timer-btn.start {
      background: var(--secondary);
      color: white;
      box-shadow: 0 4px 20px rgba(16, 185, 129, 0.3);
    }

    .timer-btn.start:hover {
      background: var(--secondary-dark);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
      transform: translateY(-3px);
    }

    .timer-btn.pause {
      background: var(--accent);
      color: white;
      box-shadow: 0 4px 20px rgba(245, 158, 11, 0.3);
    }

    .timer-btn.pause:hover {
      background: #d97706;
      box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
      transform: translateY(-3px);
    }

    .timer-btn.reset {
      background: rgba(255,255,255,0.1);
      color: white;
      backdrop-filter: blur(5px);
    }

    .timer-btn.reset:hover {
      background: rgba(255,255,255,0.2);
      transform: translateY(-3px);
    }

    .timer-settings {
      margin-top: 3rem;
      display: flex;
      justify-content: center;
      gap: 3rem;
      flex-wrap: wrap;
    }

    .timer-setting {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .timer-setting label {
      margin-bottom: 0.8rem;
      font-weight: 600;
      color: var(--gray-light);
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .timer-setting input {
      width: 80px;
      padding: 0.8rem;
      text-align: center;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      font-size: 1.1rem;
      color: white;
      transition: all 0.3s ease;
    }

    .timer-setting input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
    }

    /* GPA Calculator Styles */
    .gpa-form {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr auto;
      gap: 1.5rem;
      margin-bottom: 2rem;
      align-items: center;
    }

    @media (max-width: 768px) {
      .gpa-form {
        grid-template-columns: 1fr;
      }
    }

    .gpa-input, .gpa-select {
      padding: 1rem;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      font-size: 1rem;
      color: white;
      transition: all 0.3s ease;
    }

    .gpa-input::placeholder {
      color: rgba(255,255,255,0.5);
    }

    .gpa-select {
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      background-size: 1rem;
    }

    .gpa-select option {
      background-color: #1e293b;
      color: white;
    }

    .add-subject-btn {
      padding: 1rem 1.5rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
    }

    .add-subject-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
    }

    .subject-list {
      margin-top: 2rem;
    }

    .subject-item {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr auto;
      gap: 1.5rem;
      padding: 1.2rem;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      margin-bottom: 1rem;
      align-items: center;
      transition: all 0.3s ease;
    }

    @media (max-width: 768px) {
      .subject-item {
        grid-template-columns: 1fr;
        text-align: center;
      }
    }

    .subject-item:hover {
      background: rgba(255,255,255,0.1);
      transform: translateX(5px);
    }

    .subject-delete {
      color: var(--danger-light);
      background: none;
      border: none;
      font-size: 1.3rem;
      cursor: pointer;
      transition: transform 0.3s ease;
      padding: 0.5rem;
      border-radius: 50%;
    }

    .subject-delete:hover {
      color: var(--danger);
      transform: scale(1.2);
      background: rgba(239, 68, 68, 0.1);
    }

    .gpa-result {
      margin-top: 3rem;
      padding: 2rem;
      background: rgba(16, 185, 129, 0.1);
      border-radius: 16px;
      text-align: center;
      border: 1px solid rgba(16, 185, 129, 0.2);
      backdrop-filter: blur(5px);
    }

    .gpa-score {
      font-size: 4rem;
      font-weight: 800;
      color: var(--secondary-light);
      margin: 1rem 0;
      text-shadow: 0 0 10px rgba(110, 231, 183, 0.3);
    }

    /* AI Chat Styles */
    .chat-container {
      height: 500px;
      display: flex;
      flex-direction: column;
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .chat-messages {
      flex: 1;
      padding: 1.5rem;
      overflow-y: auto;
      background: rgba(0,0,0,0.2);
    }

    .message {
      margin-bottom: 1.5rem;
      animation: fadeIn 0.4s ease-out;
      max-width: 85%;
    }

    .message.user {
      margin-left: auto;
    }

    .message.bot {
      margin-right: auto;
    }

    .message-bubble {
      padding: 1rem 1.5rem;
      border-radius: 18px;
      line-height: 1.6;
      font-size: 1.1rem;
      position: relative;
      word-wrap: break-word;
    }

    .message.bot .message-bubble {
      background: rgba(139, 92, 246, 0.15);
      color: #e9d5ff;
      border-bottom-left-radius: 4px;
      border: 1px solid rgba(139, 92, 246, 0.3);
    }

    .message.user .message-bubble {
      background: rgba(16, 185, 129, 0.15);
      color: #a7f3d0;
      border-bottom-right-radius: 4px;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .message-bubble pre {
      background: rgba(0,0,0,0.3);
      padding: 1rem;
      border-radius: 8px;
      overflow-x: auto;
      margin: 1rem 0;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      line-height: 1.5;
      position: relative;
    }

    .message-bubble code {
      font-family: 'Courier New', monospace;
      background: rgba(0,0,0,0.3);
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      font-size: 0.9rem;
    }

    .message-bubble pre code {
      background: transparent;
      padding: 0;
    }

    .copy-btn {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: rgba(255,255,255,0.1);
      border: none;
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
      opacity: 0;
      transition: opacity 0.3s;
    }

    pre:hover .copy-btn {
      opacity: 1;
    }

.chat-input-container {
  display: flex;
  flex-wrap: wrap;
  align-items: stretch;
  gap: 1rem;
  padding: 1.5rem;
  background: rgba(255,255,255,0.1);
  border-top: 1px solid rgba(255,255,255,0.1);
}


    .chat-input {
      flex: 1;
      padding: 1rem 1.5rem;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 50px;
      font-size: 1.1rem;
      color: white;
      transition: all 0.3s ease;
    }

    .chat-input::placeholder {
      color: rgba(255,255,255,0.5);
    }

    .chat-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
    }

.send-btn {
  flex-shrink: 0;
  padding: 1rem 1.5rem;
  background: var(--primary);
  color: white;
  border: none;
  border-radius: 50px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
}
@media (max-width: 600px) {
  .chat-input-container {
    flex-direction: column;
    align-items: stretch;
  }

  .chat-input,
  .send-btn {
    width: 100%;
    margin-left: 0;
  }
}


    .send-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
    }

    /* Notes Summarizer Styles */
    .summarizer-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2.5rem;
    }

    @media (max-width: 768px) {
      .summarizer-container {
        grid-template-columns: 1fr;
      }
    }

    .notes-input, .summary-output {
      height: 350px;
      padding: 1.5rem;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      font-size: 1.1rem;
      line-height: 1.6;
      color: white;
      transition: all 0.3s ease;
    }

    .notes-input {
      resize: none;
    }

    .notes-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
    }

    .summary-output {
      background: rgba(0,0,0,0.2);
      overflow-y: auto;
    }

    .summarize-btn {
      margin-top: 2rem;
      padding: 1.2rem 2.5rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.8rem;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 4px 20px rgba(139, 92, 246, 0.3);
    }

    .summarize-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-3px);
      box-shadow: 0 6px 25px rgba(139, 92, 246, 0.4);
    }

    /* Loading States */
    .loading-state {
      display: flex;
      flex-direction: column;
      gap: 8px;
      color: var(--gray-light);
    }

    .progress-bar {
      height: 3px;
      background: rgba(255,255,255,0.1);
      overflow: hidden;
      border-radius: 3px;
    }

    .progress-bar::after {
      content: '';
      display: block;
      width: 100%;
      height: 100%;
      background: var(--primary);
      animation: progress 1.5s infinite ease-in-out;
    }

    @keyframes progress {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .api-warning {
      margin-top: 12px;
      padding: 8px;
      background: rgba(245, 158, 11, 0.1);
      border-radius: 4px;
      color: var(--accent-light);
    }

    .error-message {
      color: var(--danger-light);
      padding: 8px;
      background: rgba(239, 68, 68, 0.1);
      border-radius: 4px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Floating Elements */
    .floating-shape {
      position: fixed;
      border-radius: 50%;
      filter: blur(60px);
      opacity: 0.3;
      z-index: -1;
      animation: float 15s ease-in-out infinite;
    }

    .shape-1 {
      width: 300px;
      height: 300px;
      background: var(--primary);
      top: 10%;
      left: 5%;
      animation-delay: 0s;
    }

    .shape-2 {
      width: 400px;
      height: 400px;
      background: var(--secondary);
      bottom: 10%;
      right: 5%;
      animation-delay: 2s;
    }

    .shape-3 {
      width: 200px;
      height: 200px;
      background: var(--accent);
      top: 50%;
      left: 30%;
      animation-delay: 4s;
    }

    /* Logout Button */
    .logout-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 0.8rem 1.5rem;
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger-light);
      border: 1px solid var(--danger);
      border-radius: 50px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      z-index: 100;
    }

    .logout-btn:hover {
      background: rgba(239, 68, 68, 0.3);
      transform: translateY(-2px);
    }

    .user-info {
      position: absolute;
      top: 20px;
      left: 20px;
      color: var(--gray-light);
      font-size: 0.9rem;
      z-index: 100;
    }

    /* Responsive Adjustments */
    @media (max-width: 1024px) {
      .app-title {
        font-size: 3rem;
      }
      
      .timer-display {
        font-size: 4.5rem;
      }
      
      .gpa-score {
        font-size: 3rem;
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: 1.5rem;
      }
      
      .app-title {
        font-size: 2.5rem;
      }
      
      .task-form, .gpa-form {
        flex-direction: column;
      }
      
      .timer-display {
        font-size: 3.5rem;
      }
      
      .timer-buttons {
        flex-direction: column;
        align-items: center;
      }
      
      .timer-btn {
        width: 100%;
        justify-content: center;
      }
      
      .gpa-score {
        font-size: 2.5rem;
      }
    }

    @media (max-width: 600px) {
  .app-header {
    padding: 8px 10px; /* Reduce padding on small screens */
  }
  
  .app-title {
    font-size: 1.3rem; /* Smaller title */
  }
  
  .user-info {
    font-size: 0.45rem; /* Smaller user info text */
    max-width: 200px; /* Prevents overflow */
  }
  
  .logout-btn {
    padding: 0.4rem 0.8rem; /* Smaller button */
    font-size: 0.8rem;
  }
}

    @media (max-width: 480px) {
      .app-title {
        font-size: 2rem;
      }
      
      .app-subtitle {
        font-size: 1rem;
      }
      
      .tab-btn {
        padding: 0.6rem 1.2rem;
        font-size: 0.9rem;
      }
      
      .card {
        padding: 1.5rem;
      }
      
      .card-title {
        font-size: 1.5rem;
      }
      
      .timer-display {
        font-size: 2.5rem;
      }
      
      .timer-mode {
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <!-- Floating background shapes -->
  <div class="floating-shape shape-1"></div>
  <div class="floating-shape shape-2"></div>
  <div class="floating-shape shape-3"></div>

  <!-- User info and logout button -->
  <div class="user-info" id="userInfo">
    <i class="fas fa-circle-notch fa-spin"></i> Loading...
  </div>
  <button class="logout-btn" id="logoutBtn">
    <i class="fas fa-sign-out-alt"></i> Logout
  </button>
  <div class="container">
    <header>
      <h1 class="app-title">TaskMate</h1>
      <p class="app-subtitle">Your premium productivity companion</p>
      
      <div class="tabs">
        <button class="tab-btn active" data-tab="tasks"><i class="fas fa-tasks"></i> Tasks</button>
        <button class="tab-btn" data-tab="pomodoro"><i class="fas fa-clock"></i> Pomodoro</button>
        <button class="tab-btn" data-tab="gpa"><i class="fas fa-calculator"></i> GPA Calc</button>
        <button class="tab-btn" data-tab="ai"><i class="fas fa-robot"></i> AI Assistant</button>
        <button class="tab-btn" data-tab="summary"><i class="fas fa-file-alt"></i> Summarizer</button>
      </div>
    </header>

    <!-- Tasks Tab -->
    <div class="tab-content active" id="tasks">
      <div class="card">
        <h2 class="card-title"><i class="fas fa-tasks"></i> Task Manager</h2>
        
        <form class="task-form" id="taskForm">
          <input type="text" class="task-input" id="taskInput" placeholder="Task description" required>
          <input type="text" class="task-input" id="taskSubject" placeholder="Subject">
          <select class="task-select" id="taskType">
            <option value="" disabled selected>Select Type</option>
            <option value="Assignment">Assignment</option>
            <option value="Project">Project</option>
            <option value="Exam">Exam</option>
            <option value="Quiz">Quiz</option>
            <option value="Other">Other</option>
          </select>
          <input type="datetime-local" class="task-date" id="taskDueDate" required>
          <button type="submit" class="add-task-btn">
            <i class="fas fa-plus"></i> Add
          </button>
        </form>
        
        <ul class="task-list" id="taskList">
          <!-- Tasks will be added here dynamically -->
        </ul>
      </div>
    </div>

    <!-- Pomodoro Tab -->
    <div class="tab-content" id="pomodoro">
      <div class="card">
        <h2 class="card-title"><i class="fas fa-clock"></i> Pomodoro Timer</h2>
        
        <div class="timer-container">
          <div class="timer-mode" id="timerMode">Work</div>
          <div class="timer-display" id="timerDisplay">25:00</div>
          
          <div class="timer-buttons">
            <button class="timer-btn start" id="startBtn">
              <i class="fas fa-play"></i> Start
            </button>
            <button class="timer-btn pause" id="pauseBtn" disabled>
              <i class="fas fa-pause"></i> Pause
            </button>
            <button class="timer-btn reset" id="resetBtn" disabled>
              <i class="fas fa-redo"></i> Reset
            </button>
          </div>
          
          <div class="timer-settings">
            <div class="timer-setting">
              <label for="workDuration">Work (min)</label>
              <input type="number" id="workDuration" min="1" max="60" value="25">
            </div>
            <div class="timer-setting">
              <label for="breakDuration">Break (min)</label>
              <input type="number" id="breakDuration" min="1" max="30" value="5">
            </div>
            <div class="timer-setting">
              <label for="longBreakDuration">Long Break (min)</label>
              <input type="number" id="longBreakDuration" min="1" max="60" value="15">
            </div>
            <div class="timer-setting">
              <label for="sessionsBeforeLongBreak">Sessions Before Long Break</label>
              <input type="number" id="sessionsBeforeLongBreak" min="1" max="10" value="4">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- GPA Calculator Tab -->
    <div class="tab-content" id="gpa">
      <div class="card">
        <h2 class="card-title"><i class="fas fa-calculator"></i> GPA Calculator</h2>
        
        <form class="gpa-form" id="gpaForm">
          <input type="text" class="gpa-input" id="subjectName" placeholder="Subject Name" required>
          <select class="gpa-select" id="subjectGrade" required>
            <option value="" disabled selected>Select Grade</option>
            <option value="4.0">A (4.0)</option>
            <option value="3.5">B+ (3.5)</option>
            <option value="3.0">B (3.0)</option>
            <option value="2.5">C+ (2.5)</option>
            <option value="2.0">C (2.0)</option>
            <option value="1.5">D+ (1.5)</option>
            <option value="1.0">D (1.0)</option>
            <option value="0.0">F (0.0)</option>
          </select>
          <input type="number" class="gpa-input" id="subjectCredits" placeholder="Credits" min="0.5" step="0.5" required>
          <button type="submit" class="add-subject-btn">
            <i class="fas fa-plus"></i> Add
          </button>
        </form>
        
        <div class="subject-list" id="subjectList">
          <!-- Subjects will be added here dynamically -->
        </div>
        
        <div class="gpa-result">
          <h3>Your Cumulative GPA</h3>
          <div class="gpa-score" id="gpaScore">0.00</div>
          <p>Based on <span id="totalCredits">0</span> credit hours</p>
        </div>
      </div>
    </div>

    <!-- AI Assistant Tab -->
    <div class="tab-content" id="ai">
      <div class="card">
        <h2 class="card-title"><i class="fas fa-robot"></i> AI Assistant</h2>
        
        <div class="chat-container">
          <div class="chat-messages" id="chatMessages">
            <div class="message bot">
              <div class="message-bubble">
                Hello! I'm your AI productivity assistant. Ask me anything about time management, study techniques, or productivity hacks!
              </div>
            </div>
          </div>
          
          <div class="chat-input-container">
            <input type="text" class="chat-input" id="chatInput" placeholder="Ask me anything about productivity...">
            <button class="send-btn" id="sendBtn">
              <i class="fas fa-paper-plane"></i> Send
            </button>
            <button id="clearChatBtn" class="send-btn">
  <i class="fas fa-trash-alt"></i> Clear Chat
</button>

          </div>
        </div>
      </div>
    </div>

    <!-- Notes Summarizer Tab -->
    <div class="tab-content" id="summary">
      <div class="card">
        <h2 class="card-title"><i class="fas fa-file-alt"></i> Notes Summarizer</h2>
        
        <div class="summarizer-container">
          <textarea class="notes-input" id="notesInput" placeholder="Paste your lecture notes, article, or any long text here..."></textarea>
          <div class="summary-output" id="summaryOutput">Your concise summary will appear here...</div>
        </div>
        
        <button class="summarize-btn" id="summarizeBtn">
          <i class="fas fa-magic"></i> Summarize
        </button>
      </div>
    </div>
  </div>

  <script type="module">
    // Firebase v9+ Modular Imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { 
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      doc,
      updateDoc,
      deleteDoc,
      onSnapshot,
      query,
      where,
      orderBy,
      serverTimestamp,
      enableIndexedDbPersistence
    } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

    // Your Firebase Config
    // Replace all the # with your firebase given key
    const firebaseConfig = {
      apiKey: "#",
      authDomain: "#",
      projectId: "#",
      storageBucket: "#",
      messagingSenderId: "#",
      appId: "#",
      measurementId: "#"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Enable offline persistence
    enableIndexedDbPersistence(db).catch((err) => {
      console.log("Offline persistence error: ", err);
    });

    // Configure marked
    marked.setOptions({
      highlight: function(code, lang) {
        if (lang && hljs.getLanguage(lang)) {
          return hljs.highlight(code, { language: lang }).value;
        }
        return hljs.highlightAuto(code).value;
      },
      breaks: true,
      gfm: true
    });

    // === Global Variables ===
    let tasks = [];
    let subjects = [];
    let currentUser = null;
    let timer;
    let timeLeft = 25 * 60; // 25 minutes in seconds
    let isRunning = false;
    let isWorkTime = true;
    let sessionCount = 0;

    // === DOM Elements ===
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    const taskForm = document.getElementById('taskForm');
    const taskInput = document.getElementById('taskInput');
    const taskSubject = document.getElementById('taskSubject');
    const taskType = document.getElementById('taskType');
    const taskDueDate = document.getElementById('taskDueDate');
    const taskList = document.getElementById('taskList');
    const gpaForm = document.getElementById('gpaForm');
    const subjectList = document.getElementById('subjectList');
    const gpaScore = document.getElementById('gpaScore');
    const totalCredits = document.getElementById('totalCredits');
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');
    const notesInput = document.getElementById('notesInput');
    const summaryOutput = document.getElementById('summaryOutput');
    const summarizeBtn = document.getElementById('summarizeBtn');
    const timerMode = document.getElementById('timerMode');
    const timerDisplay = document.getElementById('timerDisplay');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');
    const workDuration = document.getElementById('workDuration');
    const breakDuration = document.getElementById('breakDuration');
    const longBreakDuration = document.getElementById('longBreakDuration');
    const sessionsBeforeLongBreak = document.getElementById('sessionsBeforeLongBreak');
    const userInfo = document.getElementById('userInfo');
    const logoutBtn = document.getElementById('logoutBtn');

    // === Auth State Management ===
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUser = user;
        userInfo.innerHTML = `<i class="fas fa-user"></i> ${user.email}`;
        
        // Load data and setup listeners
        await loadTasks(user.uid);
        await loadSubjects(user.uid);
        await loadChatHistory(user.uid);
        setupTaskListener(user.uid);
        setupSubjectListener(user.uid);
      } else {
        window.location.href = 'index.html';
      }
    });

    // Logout handler
    logoutBtn.addEventListener('click', () => {
      signOut(auth)
        .then(() => window.location.href = 'index.html')
        .catch(error => {
          console.error('Logout error:', error);
          alert('Logout failed. Please try again.');
        });
    });

    // === Tab Switching ===
    tabBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const tabId = btn.getAttribute('data-tab');
        
        // Update active tab button
        tabBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Update active tab content
        tabContents.forEach(content => content.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
      });
    });

    // === Task Manager ===
    async function loadTasks(userId) {
      try {
        const q = query(collection(db, 'users', userId, 'tasks'));
        const unsubscribe = onSnapshot(q, (snapshot) => {
          tasks = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
          renderTasks();
        });
        return unsubscribe;
      } catch (error) {
        console.error("Error loading tasks:", error);
        alert("Failed to load tasks. Please refresh the page.");
      }
    }

    async function addTask(task) {
      try {
        const docRef = await addDoc(
          collection(db, 'users', currentUser.uid, 'tasks'),
          {
            ...task,
            createdAt: serverTimestamp()
          }
        );
        return docRef.id;
      } catch (error) {
        console.error("Error adding task:", error);
        alert("Failed to add task. Please try again.");
        throw error;
      }
    }

    async function updateTask(taskId, updates) {
      try {
        await updateDoc(
          doc(db, 'users', currentUser.uid, 'tasks', taskId),
          updates
        );
      } catch (error) {
        console.error("Error updating task:", error);
        alert("Failed to update task. Please try again.");
      }
    }

    async function deleteTask(taskId) {
      try {
        await deleteDoc(
          doc(db, 'users', currentUser.uid, 'tasks', taskId)
        );
      } catch (error) {
        console.error("Error deleting task:", error);
        alert("Failed to delete task. Please try again.");
      }
    }

    function setupTaskListener(userId) {
      return onSnapshot(
        collection(db, 'users', userId, 'tasks'),
        (snapshot) => {
          tasks = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
          renderTasks();
        },
        (error) => {
          console.error("Task listener error:", error);
        }
      );
    }

    // Format date for display
    function formatDueDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleString('en-US', {
        month: 'short',
        day: 'numeric',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    // Calculate time remaining or overdue
    function getTimeStatus(dueDate) {
      const now = new Date();
      const due = new Date(dueDate);
      const diff = due - now;
      
      if (diff <= 0) {
        // Overdue
        const overdueDiff = Math.abs(diff);
        const days = Math.floor(overdueDiff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((overdueDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((overdueDiff % (1000 * 60 * 60)) / (1000 * 60));
        
        if (days > 0) return `${days} day${days > 1 ? 's' : ''} overdue`;
        if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''} overdue`;
        return `${minutes} minute${minutes > 1 ? 's' : ''} overdue`;
      } else {
        // Due in...
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        
        if (days > 0) return `Due in ${days} day${days > 1 ? 's' : ''}`;
        if (hours > 0) return `Due in ${hours} hour${hours > 1 ? 's' : ''}`;
        return `Due in ${minutes} minute${minutes > 1 ? 's' : ''}`;
      }
    }

    // Render tasks
    function renderTasks() {
      taskList.innerHTML = '';
      
      if (tasks.length === 0) {
        taskList.innerHTML = `
          <li class="task-item" style="justify-content: center; background: none;">
            <span style="color: var(--gray);">No tasks yet. Add one above!</span>
          </li>
        `;
        return;
      }
      
      // Sort tasks by due date (earliest first)
      tasks.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
      
      tasks.forEach((task, index) => {
        const taskItem = document.createElement('li');
        taskItem.className = 'task-item';
        
        // Check if task is overdue and not completed
        const isOverdue = new Date(task.dueDate) < new Date() && !task.completed;
        if (isOverdue) {
          taskItem.classList.add('overdue');
        }
        
        const timeStatus = getTimeStatus(task.dueDate);
        
        taskItem.innerHTML = `
          <div class="task-main">
            <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} data-index="${index}">
            <div class="task-content">
              <div class="task-text ${task.completed ? 'completed' : ''}">${task.text}</div>
              <div class="task-meta">
                ${task.subject ? `<span class="task-subject">${task.subject}</span>` : ''}
                ${task.type ? `<span class="task-type">${task.type}</span>` : ''}
                <span class="task-deadline">
                  <i class="fas fa-calendar-alt"></i>
                  ${formatDueDate(task.dueDate)}
                  ${isOverdue ? `<span class="task-overdue">(${timeStatus})</span>` : `<span>(${timeStatus})</span>`}
                </span>
              </div>
            </div>
            <button class="task-delete" data-index="${index}"><i class="fas fa-trash"></i></button>
          </div>
        `;
        taskList.appendChild(taskItem);
      });
    }

    // Add new task
    taskForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (taskInput.value.trim() === '' || taskDueDate.value === '') return;
      
      const newTask = {
        text: taskInput.value.trim(),
        subject: taskSubject.value.trim(),
        type: taskType.value,
        dueDate: taskDueDate.value,
        completed: false,
        createdAt: new Date().toISOString()
      };
      
      try {
        await addTask(newTask);
        taskForm.reset();
      } catch (error) {
        console.error("Task submission error:", error);
      }
    });

    // Toggle task completion
    taskList.addEventListener('change', async (e) => {
      if (e.target.classList.contains('task-checkbox')) {
        const index = e.target.getAttribute('data-index');
        const task = tasks[index];
        await updateTask(task.id, { completed: e.target.checked });
      }
    });

    // Delete task
    taskList.addEventListener('click', async (e) => {
      if (e.target.classList.contains('task-delete') || e.target.parentElement.classList.contains('task-delete')) {
        const index = e.target.classList.contains('task-delete') 
          ? e.target.getAttribute('data-index')
          : e.target.parentElement.getAttribute('data-index');
        const task = tasks[index];
        await deleteTask(task.id);
      }
    });

    // === GPA Calculator ===
    async function loadSubjects(userId) {
      try {
        const q = query(collection(db, 'users', userId, 'subjects'));
        const unsubscribe = onSnapshot(q, (snapshot) => {
          subjects = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
          renderSubjects();
        });
        return unsubscribe;
      } catch (error) {
        console.error("Error loading subjects:", error);
        alert("Failed to load subjects. Please refresh the page.");
      }
    }

    async function addSubject(subject) {
      try {
        await addDoc(
          collection(db, 'users', currentUser.uid, 'subjects'),
          subject
        );
      } catch (error) {
        console.error("Error adding subject:", error);
        alert("Failed to add subject. Please try again.");
        throw error;
      }
    }

    async function deleteSubject(subjectId) {
      try {
        await deleteDoc(
          doc(db, 'users', currentUser.uid, 'subjects', subjectId)
        );
      } catch (error) {
        console.error("Error deleting subject:", error);
        alert("Failed to delete subject. Please try again.");
      }
    }

    function setupSubjectListener(userId) {
      return onSnapshot(
        collection(db, 'users', userId, 'subjects'),
        (snapshot) => {
          subjects = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
          renderSubjects();
        },
        (error) => {
          console.error("Subject listener error:", error);
        }
      );
    }

    // Render subjects
    function renderSubjects() {
      subjectList.innerHTML = '';
      
      if (subjects.length === 0) {
        subjectList.innerHTML = `
          <div class="subject-item" style="text-align: center; background: none;">
            <div style="color: var(--gray); grid-column: 1 / -1;">No subjects added yet</div>
          </div>
        `;
      } else {
        subjects.forEach((subject, index) => {
          const subjectItem = document.createElement('div');
          subjectItem.className = 'subject-item';
          subjectItem.innerHTML = `
            <div>${subject.name}</div>
            <div>${subject.grade}</div>
            <div>${subject.credits} credits</div>
            <button class="subject-delete" data-index="${index}"><i class="fas fa-trash"></i></button>
          `;
          subjectList.appendChild(subjectItem);
        });
      }
      
      calculateGPA();
    }

    // Add new subject
    gpaForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const name = document.getElementById('subjectName').value.trim();
      const grade = document.getElementById('subjectGrade').value;
      const credits = parseFloat(document.getElementById('subjectCredits').value);
      
      if (!name || !grade || !credits) return;
      
      const gradeMap = {
        '4.0': 'A',
        '3.5': 'B+',
        '3.0': 'B',
        '2.5': 'C+',
        '2.0': 'C',
        '1.5': 'D+',
        '1.0': 'D',
        '0.0': 'F'
      };
      
      const newSubject = {
        name,
        grade: gradeMap[grade],
        gradeValue: parseFloat(grade),
        credits
      };
      
      try {
        await addSubject(newSubject);
        gpaForm.reset();
      } catch (error) {
        console.error("Subject submission error:", error);
      }
    });

    // Delete subject
    subjectList.addEventListener('click', async (e) => {
      if (e.target.classList.contains('subject-delete') || e.target.parentElement.classList.contains('subject-delete')) {
        const index = e.target.classList.contains('subject-delete') 
          ? e.target.getAttribute('data-index')
          : e.target.parentElement.getAttribute('data-index');
        const subject = subjects[index];
        await deleteSubject(subject.id);
      }
    });

    // Calculate GPA
    function calculateGPA() {
      if (subjects.length === 0) {
        gpaScore.textContent = '0.00';
        totalCredits.textContent = '0';
        return;
      }
      
      let totalGradePoints = 0;
      let totalCreditsValue = 0;
      
      subjects.forEach(subject => {
        totalGradePoints += subject.gradeValue * subject.credits;
        totalCreditsValue += subject.credits;
      });
      
      const gpa = totalGradePoints / totalCreditsValue;
      gpaScore.textContent = gpa.toFixed(2);
      totalCredits.textContent = totalCreditsValue;
      
      // Color code based on GPA
      if (gpa >= 3.5) {
        gpaScore.style.color = 'var(--secondary-light)';
      } else if (gpa >= 2.0) {
        gpaScore.style.color = 'var(--accent-light)';
      } else {
        gpaScore.style.color = 'var(--danger-light)';
      }
    }

    // === Pomodoro Timer ===
    // Update timer display
    function updateDisplay() {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    // Start timer
    function startTimer() {
      if (!isRunning) {
        isRunning = true;
        startBtn.disabled = true;
        pauseBtn.disabled = false;
        resetBtn.disabled = false;
        
        timer = setInterval(() => {
          timeLeft--;
          updateDisplay();
          
          if (timeLeft <= 0) {
            clearInterval(timer);
            isRunning = false;
            
            // Play sound
            const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3');
            audio.volume = 0.3;
            audio.play();
            
            // Switch mode
            if (isWorkTime) {
              sessionCount++;
              const isLongBreak = sessionCount % parseInt(sessionsBeforeLongBreak.value) === 0;
              
              if (isLongBreak) {
                timerMode.textContent = 'Long Break';
                timeLeft = parseInt(longBreakDuration.value) * 60;
                timerMode.style.color = 'var(--accent-light)';
              } else {
                timerMode.textContent = 'Break';
                timeLeft = parseInt(breakDuration.value) * 60;
                timerMode.style.color = 'var(--secondary-light)';
              }
              
              isWorkTime = false;
            } else {
              timerMode.textContent = 'Work';
              timeLeft = parseInt(workDuration.value) * 60;
              isWorkTime = true;
              timerMode.style.color = 'var(--primary-light)';
            }
            
            updateDisplay();
            startBtn.disabled = false;
            pauseBtn.disabled = true;
          }
        }, 1000);
      }
    }

    // Pause timer
    function pauseTimer() {
      clearInterval(timer);
      isRunning = false;
      startBtn.disabled = false;
      pauseBtn.disabled = true;
    }

    // Reset timer
    function resetTimer() {
      clearInterval(timer);
      isRunning = false;
      isWorkTime = true;
      sessionCount = 0;
      timerMode.textContent = 'Work';
      timerMode.style.color = 'var(--primary-light)';
      timeLeft = parseInt(workDuration.value) * 60;
      updateDisplay();
      startBtn.disabled = false;
      pauseBtn.disabled = true;
      resetBtn.disabled = true;
    }

    // Event listeners
    startBtn.addEventListener('click', startTimer);
    pauseBtn.addEventListener('click', pauseTimer);
    resetBtn.addEventListener('click', resetTimer);

    // Update timer when settings change
    [workDuration, breakDuration, longBreakDuration, sessionsBeforeLongBreak].forEach(input => {
      input.addEventListener('change', () => {
        if (!isRunning) {
          if (isWorkTime) {
            timeLeft = parseInt(workDuration.value) * 60;
          } else {
            const isLongBreak = sessionCount % parseInt(sessionsBeforeLongBreak.value) === 0;
            timeLeft = isLongBreak 
              ? parseInt(longBreakDuration.value) * 60
              : parseInt(breakDuration.value) * 60;
          }
          updateDisplay();
        }
      });
    });

    // Initial display
    updateDisplay();
    timerMode.style.color = 'var(--primary-light)';

    // === AI Assistant ===
    // Add message to chat
    function addMessage(text, isUser) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
      
      // Parse markdown
      const parsedContent = marked.parse(text);
      
      messageDiv.innerHTML = `
        <div class="message-bubble">${parsedContent}</div>
      `;
      
      chatMessages.appendChild(messageDiv);
      
      // Add copy buttons to code blocks
      messageDiv.querySelectorAll('pre').forEach(pre => {
        const copyBtn = document.createElement('button');
        copyBtn.className = 'copy-btn';
        copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
        copyBtn.title = 'Copy code';
        copyBtn.addEventListener('click', () => {
          const code = pre.querySelector('code')?.innerText || pre.innerText;
          navigator.clipboard.writeText(code);
          copyBtn.innerHTML = '<i class="fas fa-check"></i>';
          setTimeout(() => {
            copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
          }, 2000);
        });
        pre.appendChild(copyBtn);
      });
      
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
const conversationHistory = [
  {
    "role": "system",
    "content": "You are TaskMate, a helpful AI assistant. Always reply in **English only** unless specifically asked for another language."
  }
];


    // Get AI response with better matching
  async function getAIResponse(onDataReceived) {
  try {
    const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
      method: "POST",
      headers: {
        "Authorization": "Bearer #", //Replace the # with your api key
        "Content-Type": "application/json",
        "HTTP-Referer": window.location.origin || "http://localhost"
      },
      body: JSON.stringify({
        "model": "deepseek/deepseek-r1-0528:free", // You can change this depending on the ai you use
        "messages": conversationHistory,
        "stream": true
      })
    });

    if (!response.ok) throw new Error(`API error: ${response.status}`);

    const reader = response.body.getReader();
    const decoder = new TextDecoder();
    let fullResponse = '';

    while (true) {
      const { done, value } = await reader.read();
      if (done) break;

      const chunk = decoder.decode(value);
      const lines = chunk.split('\n').filter(line => line.trim() !== '');

      for (const line of lines) {
        const message = line.replace(/^data: /, '');
        if (message === '[DONE]') {
          return fullResponse;
        }

        try {
          const parsed = JSON.parse(message);
          const content = parsed.choices[0]?.delta?.content || '';
          if (content) {
            fullResponse += content;
            onDataReceived(content);
          }
        } catch (err) {
          console.error('Error parsing streamed message:', err);
        }
      }
    }

    return fullResponse;
  } catch (error) {
    console.error("AI Error:", error);
    return "I encountered an error. Please try again.";
  }
}
async function loadChatHistory(userId) {
  try {
    const q = query(
      collection(db, 'users', userId, 'chat'),
      orderBy('createdAt')
    );
    const snapshot = await getDocs(q);
    const chat = snapshot.docs.map(doc => doc.data());

    // Clear old messages
    chatMessages.innerHTML = "";
    conversationHistory.length = 0;
    conversationHistory.push({
      role: "system",
      content: "You are TaskMate, a helpful AI assistant. Always reply in **English only** unless specifically asked for another language."
    });

    if (chat.length === 0) {
      const welcome = "Hello! I'm your AI productivity assistant. Ask me anything about time management, study techniques, or productivity hacks!";

      // Show in UI
      addMessage(welcome, false);

      // Save in Firestore
      await addDoc(collection(db, 'users', userId, 'chat'), {
        role: "assistant",
        content: welcome,
        createdAt: serverTimestamp()
      });

      // Save in conversationHistory
      conversationHistory.push({
        role: "assistant",
        content: welcome
      });
    } else {
      chat.forEach(msg => {
        conversationHistory.push({ role: msg.role, content: msg.content });
        addMessage(msg.content, msg.role === "user");
      });
    }
  } catch (error) {
    console.error("Error loading chat history:", error);
  }
}




    // Send message
    async function sendMessage() {
  const message = chatInput.value.trim();
  if (!message) return;

  addMessage(message, true);
  chatInput.value = "";

  // Add user message to conversation history
  conversationHistory.push({ "role": "user", "content": message });
  await addDoc(collection(db, 'users', currentUser.uid, 'chat'), {
  role: "user",
  content: message,
  createdAt: serverTimestamp()
});


  const messageDiv = document.createElement('div');
  messageDiv.className = 'message bot';
  const bubble = document.createElement('div');
  bubble.className = 'message-bubble';
  messageDiv.appendChild(bubble);
  chatMessages.appendChild(messageDiv);

  chatMessages.scrollTop = chatMessages.scrollHeight;

  let accumulatedContent = '';
  let isProcessing = false;

  await getAIResponse((contentChunk) => {
    accumulatedContent += contentChunk;

    if (!isProcessing) {
      isProcessing = true;

      requestAnimationFrame(() => {
        bubble.textContent = accumulatedContent;

        const tempElement = document.createElement('div');
        tempElement.innerHTML = marked.parse(accumulatedContent + '```');

        if (!hasUnclosedMarkdown(tempElement)) {
          bubble.innerHTML = tempElement.innerHTML;
          addCopyButtonsToCompleteCodeBlocks(bubble);
        }

        chatMessages.scrollTop = chatMessages.scrollHeight;
        isProcessing = false;
      });
    }
  });

  // Add assistant response to conversation history
  conversationHistory.push({ "role": "assistant", "content": accumulatedContent });
  await addDoc(collection(db, 'users', currentUser.uid, 'chat'), {
  role: "assistant",
  content: accumulatedContent,
  createdAt: serverTimestamp()
});


  bubble.innerHTML = marked.parse(accumulatedContent);
  addCopyButtonsToCodeBlocks(bubble);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Add these new helper functions:
function hasUnclosedMarkdown(element) {
  const text = element.textContent || '';
  const codeBlocks = (text.match(/```/g) || []).length;
  if (codeBlocks % 2 !== 0) return true;
  
  const stars = (text.match(/\*\*/g) || []).length;
  if (stars % 2 !== 0) return true;
  
  const underscores = (text.match(/__/g) || []).length;
  if (underscores % 2 !== 0) return true;
  
  return false;
}

function addCopyButtonsToCompleteCodeBlocks(container) {
  container.querySelectorAll('pre').forEach(pre => {
    if (!pre.querySelector('.copy-btn') && pre.querySelector('code')) {
      const copyBtn = document.createElement('button');
      copyBtn.className = 'copy-btn';
      copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
      copyBtn.title = 'Copy code';
      copyBtn.addEventListener('click', () => {
        const code = pre.querySelector('code')?.innerText || pre.innerText;
        navigator.clipboard.writeText(code);
        copyBtn.innerHTML = '<i class="fas fa-check"></i>';
        setTimeout(() => {
          copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
        }, 2000);
      });
      pre.appendChild(copyBtn);
    }
  });
}

function addCopyButtonsToCodeBlocks(container) {
  container.querySelectorAll('pre').forEach(pre => {
    if (!pre.querySelector('.copy-btn')) {
      const copyBtn = document.createElement('button');
      copyBtn.className = 'copy-btn';
      copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
      copyBtn.title = 'Copy code';
      copyBtn.addEventListener('click', () => {
        const code = pre.querySelector('code')?.innerText || pre.innerText;
        navigator.clipboard.writeText(code);
        copyBtn.innerHTML = '<i class="fas fa-check"></i>';
        setTimeout(() => {
          copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
        }, 2000);
      });
      pre.appendChild(copyBtn);
    }
  });
}

    // Event listeners
    sendBtn.addEventListener('click', sendMessage);
    chatInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });

    // === Notes Summarizer ===
    // Configuration
    const SUMMARIZER_CONFIG = {
      minTextLength: 30,
      maxTextLength: 20000,
      apiTimeout: 15000,
      maxFallbackSentences: 3
    };

    // Main function
    async function handleSummarize() {
      const text = notesInput.value.trim();
      
      // Validate input first
      if (!validateInput(text)) return;
      
      showLoadingState();

      try {
        const apiSummary = await getApiSummaryWithTimeout(text);
        if (apiSummary) {
          showSummary(apiSummary);
        } else {
          throw new Error("Empty API response");
        }
      } catch (apiError) {
        console.warn("API Error:", apiError);
        try {
          const localSummary = localSummarizer(text);
          showSummary(localSummary, true);
        } catch (localError) {
          console.error("Local summarizer failed:", localError);
          showError("Couldn't generate summary. Please try different text.");
        }
      } finally {
        resetButton();
      }
    }

    // Input validation
    function validateInput(text) {
      if (!text) {
        showError("Please enter text to summarize");
        return false;
      }

      if (text.length < SUMMARIZER_CONFIG.minTextLength) {
        showError(`Please enter at least ${SUMMARIZER_CONFIG.minTextLength} characters`);
        return false;
      }

      if (text.length > SUMMARIZER_CONFIG.maxTextLength) {
        showError(`Text too long (max ${SUMMARIZER_CONFIG.maxTextLength} characters)`);
        return false;
      }

      return true;
    }

    // API call with timeout protection
    async function getApiSummaryWithTimeout(text) {
      const controller = new AbortController();
      const timeout = setTimeout(() => controller.abort(), SUMMARIZER_CONFIG.apiTimeout);

      try {
        const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
          method: "POST",
          headers: {
            "Authorization": "Bearer #", //Replace # with you api key
            "Content-Type": "application/json",
            "HTTP-Referer": window.location.origin || "http://localhost"
          },
          body: JSON.stringify({
            "model": "deepseek/deepseek-r1-0528:free", //You can change this depending upon the ai you use
            "messages": [
              {
                "role": "system",
                "content": "Provide a concise bullet point summary in markdown format. Focus on key concepts and main ideas. Use **bold** for important terms."
              },
              {
                "role": "user", 
                "content": text
              }
            ],
            "temperature": 0.3,
            "max_tokens": 1500
          }),
          signal: controller.signal
        });

        clearTimeout(timeout);

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.error?.message || `API error: ${response.status}`);
        }

        const data = await response.json();
        return data.choices[0]?.message?.content;
      } catch (error) {
        clearTimeout(timeout);
        if (error.name === 'AbortError') {
          throw new Error("API request timed out");
        }
        throw error;
      }
    }

    // Improved local fallback
    function localSummarizer(text) {
      try {
        // Clean and normalize text
        const cleanText = text.replace(/\s+/g, ' ').trim();
        
        // First try splitting by paragraphs
        const paragraphs = cleanText.split(/\n\s*\n+/).filter(p => p.length > 0);
        
        const sentences = [];
        paragraphs.forEach(para => {
          // Split into sentences while preserving punctuation
          const paraSentences = para.match(/[^.!?]+[.!?]+/g) || [para];
          
          if (paraSentences.length > 0) {
            // Take first sentence (usually the topic sentence)
            sentences.push(paraSentences[0].trim());
            
            // If long paragraph, take last sentence (often conclusion)
            if (paraSentences.length > 2) {
              sentences.push(paraSentences[paraSentences.length - 1].trim());
            }
          }
        });

        // Fallback if no good sentences found
        const validSentences = sentences.filter(s => s.length > 20 && s.length < 200);
        if (validSentences.length === 0) {
          return "• Couldn't generate summary from this text";
        }

        // Format as markdown bullets
        return validSentences
          .slice(0, SUMMARIZER_CONFIG.maxFallbackSentences)
          .map(s => `• ${s}`)
          .join('\n\n');
          
      } catch (error) {
        console.error("Local summarization error:", error);
        return "• Summary unavailable for this text";
      }
    }

    // UI Helpers
    function showLoadingState() {
      summaryOutput.innerHTML = `
        <div class="loading-state">
          <i class="fas fa-spinner fa-spin"></i> Processing...
          <div class="progress-bar"></div>
        </div>
      `;
      summarizeBtn.disabled = true;
      summarizeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Working';
    }

    function showSummary(content, isFallback = false) {
      summaryOutput.innerHTML = marked.parse(content);
      if (isFallback) {
        summaryOutput.innerHTML += `
          <div class="api-warning">
            <i class="fas fa-info-circle"></i> Local summary (API unavailable)
          </div>
        `;
      }
    }

    function showError(message) {
      summaryOutput.innerHTML = `
        <div class="error-message">
          <i class="fas fa-exclamation-triangle"></i> ${message}
        </div>
      `;
    }

    function resetButton() {
      summarizeBtn.disabled = false;
      summarizeBtn.innerHTML = '<i class="fas fa-magic"></i> Summarize';
    }

    // Event listener with debouncing
    let isProcessing = false;
    summarizeBtn.addEventListener('click', () => {
      if (isProcessing) return;
      isProcessing = true;
      handleSummarize().finally(() => {
        isProcessing = false;
      });
    });

    // Check for overdue tasks every minute
    setInterval(() => {
      renderTasks();
    }, 60000);
    document.getElementById("clearChatBtn").addEventListener("click", async () => {
  const chatRef = collection(db, 'users', currentUser.uid, 'chat');
  const snapshot = await getDocs(chatRef);
  const deletions = snapshot.docs.map(docSnap => deleteDoc(docSnap.ref));
  await Promise.all(deletions);
  chatMessages.innerHTML = "";
  conversationHistory.length = 1; // keep system prompt
  const temp = document.createElement("div");
temp.className = "chat-message assistant";
temp.innerHTML = marked.parse("Chat cleared.");
chatMessages.appendChild(temp);

// Auto-remove after 3 seconds
setTimeout(() => {
  temp.remove();
}, 3000);
});

  </script>
</body>
</html>
